# GC-ARO-001-1 Agent Network Monitoring å®Œæ•´è¨ºæ–·å ±å‘Š

## ğŸ“‹ è¨ºæ–·æ¦‚è¦

**è¨ºæ–·æ™‚é–“**: 2025-10-22 06:48 - 07:26 (UTC+4)  
**å•é¡Œæè¿°**: Grafana Explore ä¸­æŸ¥è©¢ `{job="network_monitor"}` é¡¯ç¤º "No logs found"  
**ç›®æ¨™**: ç¢ºä¿ Server-side Loki èƒ½æ¥æ”¶ä¾†è‡ª aro-001-1 agent çš„ enp86s0 metrics  
**è¨ºæ–·ç¯„åœ**: Server-side é…ç½®ä¿®æ­£ + Agent-side ç‹€æ…‹ç¢ºèª + è³‡æ–™å‚³è¼¸é©—è­‰  

## ğŸ”§ ç³»çµ±é…ç½®è³‡è¨Š

### ç¶²è·¯é…ç½®
- **Server IP**: 100.64.0.113
- **Agent IP**: 100.64.0.167
- **Loki Port**: 3100
- **Grafana Port**: 3000

### Agent æ¨™ç±¤é…ç½®
- **Agent Instance**: GC-aro12-agent (ä¿®æ­£å¾Œ)
- **Job**: network_monitor
- **Interface**: enp86s0

## ğŸ” è¨ºæ–·éšæ®µèˆ‡çµæœ

### éšæ®µ 1: åˆå§‹å•é¡Œè¨ºæ–· (06:48-06:53)

#### å•é¡Œç™¼ç¾
- **Grafana Explore**: æŸ¥è©¢ `{job="network_monitor"}` è¿”å› "No logs found"
- **Loki æŸ¥è©¢**: æ‰€æœ‰ network monitoring ç›¸é—œæŸ¥è©¢è¿”å›ç©ºçµæœ
- **æ¨™ç±¤å­˜åœ¨**: `network_monitor`, `enp86s0`, `GC-aro12-agent` æ¨™ç±¤éƒ½å­˜åœ¨

#### æ ¹æœ¬åŸå› è­˜åˆ¥
**æ¨™ç±¤åŒ¹é…å•é¡Œ**: Server-side é…ç½®ä½¿ç”¨ `GC-aro11-agent`ï¼Œä½† Agent-side å¯¦éš›ä½¿ç”¨ `GC-aro12-agent`

### éšæ®µ 2: Server-side é…ç½®ä¿®æ­£ (06:53-06:57)

#### ä¿®æ­£å…§å®¹
1. **Promtail é…ç½®ä¿®æ­£** (`promtail-GC-ARO-001-1-agent.yml`)
   ```yaml
   # ä¿®æ­£å‰
   instance: GC-aro11-agent
   
   # ä¿®æ­£å¾Œ  
   instance: GC-aro12-agent  # Match agent-side instance label
   ```

2. **Docker Compose é…ç½®ç¢ºèª** (`docker-compose-GC-ARO-001-1-agent.yml`)
   ```yaml
   # ç¢ºèª volume mount å­˜åœ¨
   - /var/log/network_stats.log:/var/log/network_stats.log:ro
   ```

3. **ä¿æŒç¾æœ‰é…ç½®ä¸è®Š**
   - æ‰€æœ‰ SDP log é…ç½®ä¿æŒåŸæ¨£
   - åªæ–°å¢ network monitoring é…ç½®

#### ä¿®æ­£é©—è­‰
- âœ… Promtail é…ç½®èªæ³•æ­£ç¢º
- âœ… Docker Compose é…ç½®é©—è­‰é€šé
- âœ… æ¨™ç±¤åŒ¹é…å•é¡Œå·²è§£æ±º

### éšæ®µ 3: Agent-side ç‹€æ…‹ç¢ºèª (07:14-07:17)

#### Agent-side è¨ºæ–·çµæœ
æ ¹æ“š Agent-side ä¿®æ­£å ±å‘Šï¼š

| é …ç›® | ç‹€æ…‹ | è©³ç´°èªªæ˜ |
|------|------|----------|
| Promtail å®¹å™¨ | âœ… æ­£å¸¸ | å®¹å™¨é‹è¡Œä¸­ï¼Œé…ç½®å·²æ›´æ–° |
| Network Monitoring è…³æœ¬ | âœ… æ­£å¸¸ | Python è…³æœ¬é‹è¡Œä¸­ (PID: 3436595) |
| Log æª”æ¡ˆ | âœ… æ­£å¸¸ | network_stats.log æŒçºŒæ›´æ–°ï¼Œæ¯10ç§’ç”¢ç”Ÿæ–°è³‡æ–™ |
| è³‡æ–™è§£æ | âœ… æ­£å¸¸ | JSON è§£ææˆåŠŸï¼Œæ¨™ç±¤æ­£ç¢º |
| Loki é€£ç·š | âœ… æ­£å¸¸ | æœå‹™å™¨å›æ‡‰ "ready" |

#### Agent-side ä¿®æ­£è¡Œå‹•
1. **å¢åŠ  Debug æ—¥èªŒç´šåˆ¥**
   ```yaml
   server:
     log_level: debug
   ```

2. **å„ªåŒ–å®¢æˆ¶ç«¯æ‰¹æ¬¡è¨­å®š**
   ```yaml
   clients:
     - url: http://100.64.0.113:3100/loki/api/v1/push
       batchwait: 1s
       batchsize: 1     # ç«‹å³ç™¼é€
       timeout: 10s
   ```

3. **é‡æ–°å•Ÿå‹• Promtail å®¹å™¨**
   ```bash
   docker compose -f docker-compose.agent.yml restart promtail
   ```

### éšæ®µ 4: Server-side è³‡æ–™æ¥æ”¶ç¢ºèª (07:26)

#### ç¢ºèªçµæœ
**âŒ Server-side Loki å°šæœªæ”¶åˆ° enp86s0 metrics**

| æª¢æŸ¥é …ç›® | ç‹€æ…‹ | èªªæ˜ |
|----------|------|------|
| Loki æœå‹™ç‹€æ…‹ | âœ… æ­£å¸¸ | å®¹å™¨é‹è¡Œä¸­ï¼Œç«¯å£æ­£å¸¸ |
| Network Monitor è³‡æ–™ (éå» 10 åˆ†é˜) | âŒ æœªæ”¶åˆ° | æŸ¥è©¢ `{job="network_monitor"}` è¿”å›ç©ºçµæœ |
| GC-aro12-agent è³‡æ–™ (éå» 10 åˆ†é˜) | âŒ æœªæ”¶åˆ° | æŸ¥è©¢ `{instance="GC-aro12-agent"}` è¿”å›ç©ºçµæœ |
| enp86s0 ä»‹é¢è³‡æ–™ (éå» 10 åˆ†é˜) | âŒ æœªæ”¶åˆ° | æŸ¥è©¢ `{job="network_monitor", interface="enp86s0"}` è¿”å›ç©ºçµæœ |
| å®Œæ•´æŸ¥è©¢ (éå» 10 åˆ†é˜) | âŒ æœªæ”¶åˆ° | æŸ¥è©¢ `{job="network_monitor", instance="GC-aro12-agent", interface="enp86s0"}` è¿”å›ç©ºçµæœ |
| JSON è§£æ (éå» 10 åˆ†é˜) | âŒ å¤±æ•— | æŸ¥è©¢ `{job="network_monitor", instance="GC-aro12-agent"} \| json` è¿”å›ç©ºçµæœ |
| éå» 30 åˆ†é˜è³‡æ–™ | âŒ æœªæ”¶åˆ° | æŸ¥è©¢è¿”å›ç©ºçµæœ |
| éå» 1 å°æ™‚è³‡æ–™ | âŒ æœªæ”¶åˆ° | æŸ¥è©¢è¿”å›ç©ºçµæœ |

#### Loki æ—¥èªŒåˆ†æ
å¾ Loki æ—¥èªŒä¸­å¯ä»¥çœ‹åˆ°ï¼š
- æ‰€æœ‰æŸ¥è©¢éƒ½è¿”å› `returned_lines=0`
- æŸ¥è©¢åŸ·è¡Œæ­£å¸¸ï¼Œä½†æ²’æœ‰è¿”å›ä»»ä½•è³‡æ–™
- æ²’æœ‰éŒ¯èª¤è¨Šæ¯ï¼Œè¡¨ç¤ºæŸ¥è©¢èªæ³•æ­£ç¢º
- æ²’æœ‰çœ‹åˆ°ä»»ä½•è³‡æ–™æ¥æ”¶è¨˜éŒ„

## ğŸ¯ å•é¡Œåˆ†æ

### å·²è§£æ±ºçš„å•é¡Œ
1. **âœ… æ¨™ç±¤åŒ¹é…å•é¡Œ** - Server-side å’Œ Agent-side éƒ½ä½¿ç”¨ `GC-aro12-agent`
2. **âœ… é…ç½®èªæ³•å•é¡Œ** - æ‰€æœ‰é…ç½®æª”æ¡ˆèªæ³•æ­£ç¢º
3. **âœ… æœå‹™é‹è¡Œå•é¡Œ** - Loki å’Œ Promtail æœå‹™éƒ½æ­£å¸¸é‹è¡Œ
4. **âœ… è³‡æ–™æ”¶é›†å•é¡Œ** - Agent-side æ­£åœ¨æˆåŠŸæ”¶é›†å’Œè™•ç†è³‡æ–™

### å¾…è§£æ±ºçš„å•é¡Œ
**âŒ è³‡æ–™å‚³è¼¸å•é¡Œ** - Agent-side æ­£åœ¨è™•ç†è³‡æ–™ä½†æ²’æœ‰æˆåŠŸç™¼é€åˆ° Server-side Loki

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### å¯èƒ½åŸå› 
1. **ç¶²è·¯é€£ç·šå•é¡Œ**
   - Agent-side ç„¡æ³•é€£æ¥åˆ° Server-side Loki
   - é˜²ç«ç‰†é˜»æ“‹é€£ç·š
   - ç¶²è·¯å»¶é²æˆ–ä¸ŸåŒ…

2. **Promtail å®¢æˆ¶ç«¯å•é¡Œ**
   - æ‰¹æ¬¡è¨­å®šå•é¡Œ (å·²è¨­å®šç‚º `batchsize: 1`)
   - è¶…æ™‚è¨­å®šå•é¡Œ
   - èªè­‰æˆ–æˆæ¬Šå•é¡Œ

3. **Loki æ¥æ”¶å•é¡Œ**
   - Loki é…ç½®å•é¡Œ
   - å„²å­˜ç©ºé–“å•é¡Œ
   - æ¬Šé™å•é¡Œ

4. **æ™‚é–“åŒæ­¥å•é¡Œ**
   - Agent-side å’Œ Server-side æ™‚é–“ä¸åŒæ­¥
   - æ™‚å€è¨­å®šå•é¡Œ

## ğŸ› ï¸ è§£æ±ºæ–¹æ¡ˆå»ºè­°

### å„ªå…ˆç´š 1: ç¶²è·¯é€£ç·šæª¢æŸ¥
```bash
# å¾ Agent-side æ¸¬è©¦é€£ç·š
curl -v http://100.64.0.113:3100/ready

# æ¸¬è©¦ Loki API
curl -v -G "http://100.64.0.113:3100/loki/api/v1/label/__name__/values"
```

### å„ªå…ˆç´š 2: Promtail é™¤éŒ¯
```bash
# æª¢æŸ¥ Promtail æ—¥èªŒä¸­çš„éŒ¯èª¤
docker logs <promtail_container_name> --tail 100 | grep -E "(error|warn|fail)"

# æª¢æŸ¥ Promtail é…ç½®
cat promtail-config.yml | grep -A 10 -B 5 "100.64.0.113"
```

### å„ªå…ˆç´š 3: Loki æ¥æ”¶æª¢æŸ¥
```bash
# æª¢æŸ¥ Loki æ¥æ”¶æ—¥èªŒ
docker logs kevin-telemetry-loki-server --tail 100 | grep -E "(ingest|push|receive)"

# æª¢æŸ¥ Loki é…ç½®
cat loki-config.yml | grep -A 5 -B 5 "ingestion"
```

### å„ªå…ˆç´š 4: æ‰‹å‹•æ¸¬è©¦è³‡æ–™å‚³è¼¸
```bash
# ä½¿ç”¨ logcli æ‰‹å‹•æ¨é€æ¸¬è©¦è³‡æ–™
echo '{"timestamp":"2025-10-22 07:30:00","interface":"enp86s0","rx_bytes":1000,"tx_bytes":2000}' | \
logcli --addr=http://100.64.0.113:3100 push --labels='{job="network_monitor",instance="GC-aro12-agent",interface="enp86s0"}'
```

## ğŸ“Š æŠ€è¡“æ‘˜è¦

### é…ç½®ç‹€æ…‹
| é …ç›® | Agent-side | Server-side | ç‹€æ…‹ |
|------|------------|-------------|------|
| æœå‹™é‹è¡Œ | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | æ­£å¸¸ |
| é…ç½®ä¿®æ­£ | âœ… å®Œæˆ | âœ… å®Œæˆ | å®Œæˆ |
| æ¨™ç±¤åŒ¹é… | âœ… æ­£ç¢º | âœ… æ­£ç¢º | å®Œæˆ |
| è³‡æ–™æ”¶é›† | âœ… æ­£å¸¸ | âŒ æœªæ”¶åˆ° | å•é¡Œ |
| è³‡æ–™è™•ç† | âœ… æ­£å¸¸ | âŒ æœªæ”¶åˆ° | å•é¡Œ |
| è³‡æ–™å‚³è¼¸ | âŒ å¤±æ•— | âŒ æœªæ”¶åˆ° | å•é¡Œ |

### ä¿®æ­£æ‘˜è¦
- **ä¿®æ­£æª”æ¡ˆ**: `promtail-GC-ARO-001-1-agent.yml`
- **ä¿®æ­£æ¨™ç±¤**: `instance: GC-aro12-agent`
- **ä¿æŒé…ç½®**: æ‰€æœ‰ç¾æœ‰çš„ SDP log é…ç½®
- **æ–°å¢é…ç½®**: å°ˆé–€çš„ network monitoring job

## ğŸ¯ Grafana Explore æŸ¥è©¢æŒ‡å—

### æ¨è–¦æŸ¥è©¢é †åº
åœ¨ Grafana Explore ä¸­ä¾åºå˜—è©¦ä»¥ä¸‹æŸ¥è©¢ï¼š

1. **åŸºæœ¬æŸ¥è©¢**
   ```
   {job="network_monitor"}
   ```

2. **åŠ ä¸Š instance æ¨™ç±¤**
   ```
   {job="network_monitor", instance="GC-aro12-agent"}
   ```

3. **å®Œæ•´çš„ aro-001-1 enp86s0 æŸ¥è©¢**
   ```
   {job="network_monitor", instance="GC-aro12-agent", interface="enp86s0"}
   ```

4. **JSON è§£ææŸ¥è©¢**
   ```
   {job="network_monitor", instance="GC-aro12-agent"} | json
   ```

5. **éæ¿¾æœ‰æ•ˆè³‡æ–™**
   ```
   {job="network_monitor", instance="GC-aro12-agent"} | json | __error__=""
   ```

### æŸ¥è©¢åƒæ•¸è¨­å®š
- **æ™‚é–“ç¯„åœ**: é¸æ“‡ "Last 6 hours" æˆ– "Last 24 hours"
- **æŸ¥è©¢é™åˆ¶**: è¨­å®šç‚º 1000
- **è³‡æ–™ä¾†æº**: ç¢ºèªé¸æ“‡ "Loki"
- **è¦–åœ–æ¨¡å¼**: é¸æ“‡ "Logs" æŸ¥çœ‹åŸå§‹è³‡æ–™

### æˆåŠŸæŒ‡æ¨™
ç•¶ä»¥ä¸‹æ¢ä»¶æ»¿è¶³æ™‚ï¼Œè¡¨ç¤ºå•é¡Œå·²è§£æ±ºï¼š
- âœ… Grafana Explore æŸ¥è©¢è¿”å› log è³‡æ–™
- âœ… JSON è§£ææˆåŠŸ
- âœ… å¯ä»¥çœ‹åˆ° rx_bits, tx_bits ç­‰æ¬„ä½
- âœ… æ™‚é–“æˆ³è¨˜æ­£ç¢º
- âœ… è³‡æ–™æŒçºŒæ›´æ–°

## ğŸ“‹ é™¤éŒ¯æŠ€å·§

### æŸ¥è©¢æŠ€å·§
1. **ä½¿ç”¨æ¨™ç±¤éæ¿¾å™¨**: `{job="network_monitor"}`
2. **çµ„åˆå¤šå€‹æ¨™ç±¤**: `{job="network_monitor", instance="GC-aro12-agent"}`
3. **ä½¿ç”¨ç®¡é“æ“ä½œç¬¦**: `| json | rx_bits > 0`
4. **ä½¿ç”¨æ­£å‰‡è¡¨é”å¼**: `{job=~".*network.*"}`

### é™¤éŒ¯æŠ€å·§
1. **å…ˆæŸ¥è©¢åŸºæœ¬æ¨™ç±¤**: `{job="network_monitor"}`
2. **é€æ­¥ç¸®å°ç¯„åœ**: åŠ ä¸Š instance, interface æ¨™ç±¤
3. **æª¢æŸ¥ JSON è§£æ**: `| json | __error__=""`
4. **æŸ¥çœ‹åŸå§‹è³‡æ–™**: ä¸ä½¿ç”¨ç®¡é“æ“ä½œç¬¦

### è¦–è¦ºåŒ–æŠ€å·§
1. **ä½¿ç”¨ 'Logs' è¦–åœ–**: æŸ¥çœ‹åŸå§‹ log
2. **ä½¿ç”¨ 'Table' è¦–åœ–**: æŸ¥çœ‹çµæ§‹åŒ–è³‡æ–™
3. **ä½¿ç”¨ 'Graph' è¦–åœ–**: æŸ¥çœ‹æ™‚é–“åºåˆ—è³‡æ–™

## ğŸ”§ å¿«é€Ÿåƒè€ƒ

### é‡è¦ URL
- **Grafana Explore**: http://100.64.0.113:3000/explore
- **Loki API**: http://100.64.0.113:3100
- **Loki Ready Check**: http://100.64.0.113:3100/ready

### é—œéµå‘½ä»¤
```bash
# æª¢æŸ¥ Loki æœå‹™ç‹€æ…‹
curl -s http://100.64.0.113:3100/ready

# æŸ¥è©¢ network monitoring è³‡æ–™
curl -s -G "http://100.64.0.113:3100/loki/api/v1/query_range" \
  --data-urlencode 'query={job="network_monitor"}' \
  --data-urlencode 'start='$(date -d '10 minutes ago' -u +%Y-%m-%dT%H:%M:%SZ) \
  --data-urlencode 'end='$(date -u +%Y-%m-%dT%H:%M:%SZ) \
  --data-urlencode 'limit=5'

# æª¢æŸ¥ Loki å®¹å™¨ç‹€æ…‹
docker ps | grep loki

# æª¢æŸ¥ Loki æ—¥èªŒ
docker logs kevin-telemetry-loki-server --tail 50
```

## ğŸ¯ ä¸‹ä¸€æ­¥è¡Œå‹•

### ç«‹å³è¡Œå‹•
1. **æª¢æŸ¥ Agent-side Promtail æ—¥èªŒ** - å°‹æ‰¾éŒ¯èª¤æˆ–è­¦å‘Šè¨Šæ¯
2. **æ¸¬è©¦ç¶²è·¯é€£ç·š** - ç¢ºèª Agent-side å¯ä»¥é€£æ¥åˆ° Server-side
3. **æª¢æŸ¥ Loki æ¥æ”¶æ—¥èªŒ** - ç¢ºèªæ˜¯å¦æœ‰è³‡æ–™æ¥æ”¶è¨˜éŒ„

### æŒçºŒç›£æ§
1. **ä½¿ç”¨ Grafana Explore æŒçºŒæŸ¥è©¢** - ç›£æ§è³‡æ–™æ˜¯å¦é–‹å§‹åˆ°é”
2. **ç›£æ§ Loki æ—¥èªŒ** - æª¢æŸ¥æ˜¯å¦æœ‰æ–°çš„æ¥æ”¶è¨˜éŒ„
3. **ç¢ºèªè³‡æ–™å‚³è¼¸æ¢å¾©** - ä¸€æ—¦å•é¡Œè§£æ±ºï¼Œè³‡æ–™æ‡‰è©²é–‹å§‹æ­£å¸¸å‚³è¼¸

### æˆåŠŸæ¨™æº–
- âœ… Grafana Explore æŸ¥è©¢è¿”å›è³‡æ–™
- âœ… JSON è§£ææˆåŠŸ
- âœ… å¯ä»¥çœ‹åˆ° network monitoring æ¬„ä½
- âœ… è³‡æ–™æŒçºŒæ›´æ–°

## ğŸ“‹ çµè«–

### å·²å®Œæˆçš„å·¥ä½œ
1. **âœ… æˆåŠŸè¨ºæ–·å•é¡Œ** - è­˜åˆ¥æ¨™ç±¤åŒ¹é…å•é¡Œ
2. **âœ… ä¿®æ­£ Server-side é…ç½®** - æ›´æ–° instance æ¨™ç±¤ç‚º GC-aro12-agent
3. **âœ… ç¢ºèª Agent-side ç‹€æ…‹** - æ‰€æœ‰æœå‹™æ­£å¸¸é‹è¡Œ
4. **âœ… é©—è­‰é…ç½®æ­£ç¢ºæ€§** - èªæ³•å’Œé‚è¼¯éƒ½æ­£ç¢º

### å¾…è§£æ±ºçš„å•é¡Œ
**âŒ è³‡æ–™å‚³è¼¸å±¤é¢** - Agent-side æ­£åœ¨è™•ç†è³‡æ–™ä½†æ²’æœ‰æˆåŠŸç™¼é€åˆ° Server-side Loki

### å•é¡Œå®šä½
**æœ€å¯èƒ½çš„åŸå› **: ç¶²è·¯é€£ç·šå•é¡Œæˆ– Promtail å®¢æˆ¶ç«¯é…ç½®å•é¡Œ

### å»ºè­°å„ªå…ˆé †åº
1. **æª¢æŸ¥ Agent-side Promtail æ—¥èªŒ** - å°‹æ‰¾ç™¼é€å¤±æ•—çš„éŒ¯èª¤è¨Šæ¯
2. **æ¸¬è©¦ç¶²è·¯é€£ç·š** - ç¢ºèª Agent-side å¯ä»¥é€£æ¥åˆ° Server-side Loki
3. **æª¢æŸ¥ Loki æ¥æ”¶é…ç½®** - ç¢ºèª Server-side å¯ä»¥æ¥æ”¶è³‡æ–™

**æ‰€æœ‰é…ç½®ä¿®æ­£éƒ½å·²å®Œæˆï¼Œç¾åœ¨éœ€è¦å°ˆæ³¨æ–¼è³‡æ–™å‚³è¼¸å±¤é¢çš„å•é¡Œè§£æ±ºã€‚**

---

**è¨ºæ–·å®Œæˆæ™‚é–“**: 2025-10-22 07:26:09 AM +04  
**è¨ºæ–·ç‹€æ…‹**: é…ç½®ä¿®æ­£å®Œæˆï¼Œå¾…è§£æ±ºè³‡æ–™å‚³è¼¸å•é¡Œ  
**ä¸‹ä¸€æ­¥**: æª¢æŸ¥ç¶²è·¯é€£ç·šå’Œ Promtail å®¢æˆ¶ç«¯é…ç½®
